---
title: "Integrating JWT in ASP.NET Core 6"
summary: "JWT (JSON Web Token) is a secure and efficient way to transmit information between different systems as JSON objects."
publishedAt: "2023-03-30 19:00:00"
topics:
  - Backend
  - Asp Net
  - JWT
---

JWT (JSON Web Token) is a secure and efficient way to transmit information between different systems as JSON objects. In the context of web APIs,
JWT is often used as an authentication and authorization mechanism, allowing users to authenticate with a web application and then authorize
API requests based on their access level.

In this article, I’ll show you how to implement JWT in a Web API application using ASP.NET Core 6. With JWT authentication,
we can secure a Web API by following these steps:

## Create an ASP.NET Core Web API Project in Visual Studio 2022

To begin, open Visual Studio 2022 and start a new project.  
Click “Create a new project” and select “ASP.NET Core Web API.”

Next, specify the project name and location in the “Configure your new project” window and click “Next.” Then,
on the “Additional information” screen, leave everything at its defaults and click “Create.”

## Install the JwtBearer NuGet Package

To enable JWT authentication, install the `Microsoft.AspNetCore.Authentication.JwtBearer`
package in your project. You can do this via **Tools > NuGet Package Manager > Manage NuGet Packages for Solution** in Visual Studio,
search for `Microsoft.AspNetCore.Authentication.JwtBearer`, and install it.

Or, from the NuGet Console or .NET CLI:

```bash
NuGet\Install-Package Microsoft.AspNetCore.Authentication.JwtBearer -Version 6.0.15
```

```bash
dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer --version 6.0.15
```

## Specify the Secret Key in appsettings.json

Next, create a section in `appsettings.json` for the issuer, audience, and secret key used to create the JSON Web Token.

Add the following to `appsettings.json`:

```json
// appsettings.json

{
  "Jwt": {
    "Issuer": "https://alckor.dev/",
    "Audience": "https://alckor.dev/",
    "Key": "This is a sample secret key"
  }
}
```

Be sure to define a strong secret key and keep it in a secure place.

<Alert variant="light" color="blue" title="Nota">
  JWT uses a secret key to generate and validate tokens. It’s important to keep
  this key secure and not share it. Anyone with access to the key could generate
  valid tokens and access protected resources. Store the key in a secure
  location, such as environment variables or a key management service, and avoid
  using default or easy-to-guess keys.
</Alert>

## Configure Authentication in Program.cs

To configure JWT authentication at startup, call AddAuthentication in `Program.cs`.
Specify the authentication scheme as `JwtBearer` and configure token parameters via `AddJwtBearer`.

Read Issuer, Audience, and Key from configuration, and validate them with `TokenValidationParameters`:

```csharp
// Program.cs

using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.IdentityModel.Tokens;
using System.Text;

builder.Services.AddAuthentication(x =>
{
    x.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
    x.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
    x.DefaultScheme = JwtBearerDefaults.AuthenticationScheme;
}).AddJwtBearer(x =>
{
    x.TokenValidationParameters = new TokenValidationParameters
    {
        ValidIssuer = builder.Configuration["Jwt:Issuer"],
        ValidAudience = builder.Configuration["Jwt:Audience"],
        IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(builder.Configuration["Jwt:Key"])),
        ValidateIssuer = true,
        ValidateAudience = true,
        ValidateLifetime = true,
        ValidateIssuerSigningKey = true,
    };
});

builder.Services.AddAuthorization();

app.UseAuthentication();
app.UseAuthorization();
```

This sets up JWT authentication and authorization for your ASP.NET Core 6 application.

## Create a User Model

To store login credentials, create a `User.cs` class in the `Entities` folder:

```csharp
// Entities/User.cs

namespace ApiJWT.Entities
{
    public class User
    {
        public string Username { get; set; } = null!;
        public string Password { get; set; } = null!;
    }
}
```

This class allows you to store and validate user credentials.

## Build the Endpoints

We’ll create three controllers to demonstrate authentication:

### AuthController

This controller generates and returns the JWT:

```csharp
// Controllers/AuthController.cs

using ApiJWT.Entities;
using Microsoft.AspNetCore.Mvc;
using Microsoft.IdentityModel.Tokens;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using System.Text;

namespace ApiJWT.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class AuthController : ControllerBase
    {
        private readonly IConfiguration _config;

        public AuthController(IConfiguration config)
        {
            _config = config;
        }

        [HttpPost]
        public ActionResult PostAuth(User user)
        {
            if (user.Username == "alckordev" && user.Password == "zxcvbnm")
            {
                var issuer = _config["Jwt:Issuer"];
                var audience = _config["Jwt:Audience"];
                var key = Encoding.UTF8.GetBytes(_config["Jwt:Key"]);

                var tokenDescriptor = new SecurityTokenDescriptor
                {
                    Subject = new ClaimsIdentity(new[]
                    {
                        new Claim("Id", Guid.NewGuid().ToString()),
                        new Claim("Username", user.Username),
                        new Claim(JwtRegisteredClaimNames.Sub, user.Username),
                        new Claim(JwtRegisteredClaimNames.Email, user.Username),
                        new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())
                    }),
                    Expires = DateTime.UtcNow.AddMinutes(5),
                    Issuer = issuer,
                    Audience = audience,
                    SigningCredentials = new SigningCredentials(
                        new SymmetricSecurityKey(key),
                        SecurityAlgorithms.HmacSha256Signature
                    )
                };

                var tokenHandler = new JwtSecurityTokenHandler();
                var jwtToken = tokenHandler.CreateToken(tokenDescriptor);
                var stringToken = tokenHandler.WriteToken(jwtToken);

                return Ok(new
                {
                    token = stringToken
                });
            }

            return Unauthorized();
        }
    }
}
```

### PublicController

A simple controller that does not require authorization:

```csharp
// Controllers/PublicController.cs

using Microsoft.AspNetCore.Mvc;

namespace ApiJWT.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class PublicController : ControllerBase
    {
        [HttpGet("GetWelcomeMessage")]
        public ActionResult GetWelcomeMessage()
        {
            return Ok(new
            {
                Title = "Welcome!",
                message = "I'm a public endpoint."
            });
        }
    }
}
```

### PrivateController

A protected controller using `[Authorize]`:

```csharp
// Controllers/PrivateController.cs

using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace ApiJWT.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    [Authorize]
    public class PrivateController : ControllerBase
    {
        [HttpGet("GetWelcomeMessage")]
        public ActionResult GetWelcomeMessage()
        {
            return Ok(new
            {
                Title = "Welcome!",
                message = "I'm a private endpoint."
            });
        }
    }
}
```

If you call this endpoint without a token, you’ll get a 401 Unauthorized status. To access it, include the JWT in the Authorization header:

```tsx
Authorization: Bearer {YOUR_TOKEN}
```

### Accessing Authenticated User Data

To retrieve the authenticated user’s data, update `PrivateController`:

```csharp
// Controllers/PrivateController.cs

using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using System.Security.Claims;

namespace ApiJWT.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    [Authorize]
    public class PrivateController : ControllerBase
    {
        [HttpGet("GetWelcomeMessage")]
        public ActionResult GetWelcomeMessage()
        {
            var username = HttpContext.User.FindFirstValue("Username");

            return Ok(new
            {
                Title = $"Welcome {username}!",
                message = "I'm a private endpoint."
            });
        }
    }
}
```

Here we extract the `Username` claim from the JWT. You can similarly access the `Id` or other claims you added.

The `Microsoft.AspNetCore.Authentication.JwtBearer` library handles token decoding and validation automatically,
covering most common JWT use cases with robust security.

## Conclusion

In this tutorial, we learned how to add JWT authentication to a RESTful API built with ASP.NET Core 6. We configured the application for JWT,
generated tokens via a custom endpoint, and protected our API endpoints. We also decoded and validated JWTs automatically and accessed user data from the token.

JWT authentication is an excellent choice for securing RESTful APIs, since tokens are self-contained and stateless.
They can be sent in HTTP headers, making them easy to integrate with various clients.

I hope you found this tutorial helpful. If you have any questions or comments, feel free to leave them below. Thanks for reading!
