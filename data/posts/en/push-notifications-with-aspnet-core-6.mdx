---
title: "Implement Push Notifications with ASP.NET + JWT and Firebase Cloud Messaging"
summary: "Push notifications are essential in modern applications, allowing you to communicate with users and keep them informed in real time. In this article, we’ll describe how to implement push notifications in an API using JSON Web Tokens (JWT) and Firebase Cloud Messaging (FCM)."
cover: "/images/data/push-notifications-with-aspnet-core-6.webp"
publishedAt: "2023-04-01 19:00:00"
topics:
  - Backend
  - Asp Net
  - JWT
---

Push notifications are essential in modern applications, allowing you to communicate with users and keep them informed in real time. In this article,
we’ll describe how to implement push notifications in an API using JSON Web Tokens (JWT) and Firebase Cloud Messaging (FCM).

We’ll assume you have already implemented JWT authentication in your ASP.NET Core 6 project; if not, please read
[“How to Implement JWT in ASP.NET Core 6”](https://alckor.dev/jwt-authentication-in-aspnet-core-6) before proceeding, as we won’t cover that topic here.

## Package Installation

To enable sending push notifications, install the following NuGet packages:

- `FirebaseAdmin`
- `Google.Apis.Auth.OAuth2`

You can add them via the NuGet Package Manager or the .NET CLI:

```bash
dotnet add package FirebaseAdmin
dotnet add package Google.Apis.Auth.OAuth2
```

## Configure Firebase Settings in appsettings.json

Next, create a section in your `appsettings.json` with the credentials generated by the Firebase Admin SDK:

```json
// appsettings.json

{
  "Firebase": {
    "Type": "service_account",
    "ProjectId": "",
    "PrivateKeyId": "",
    "PrivateKey": "",
    "ClientEmail": "",
    "ClientId": "",
    "AuthUri": "",
    "TokenUri": "",
    "AuthProviderCertUrl": "",
    "ClientCertUrl": ""
  }
}
```

## Create a Notification Model

Define a `Notify` class in `Entities/Notify.cs` to represent the notification payload:

```csharp
// Entities/Notify.cs

namespace ApiJWT.Entities
{
    public class Notify
    {
        public string Title { get; set; } = null!;
        public string Body { get; set; } = null!;
    }
}
```

## Implement the Notifications Controller

Follow these steps to build the controller responsible for sending push notifications:

### Create the Controller

In `Controllers/NotifyController.cs`, add `[Authorize]` so only authenticated users can call it:

```csharp
// Controllers/NotifyController.cs

using Microsoft.AspNetCore.Mvc;

namespace ApiJWT.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    [Authorize]
    public class NotifyController : ControllerBase
    {
    }
}
```

### Import Required Packages

```csharp
// Controllers/NotifyController.cs

using FirebaseAdmin;
using FirebaseAdmin.Messaging;
using Google.Apis.Auth.OAuth2;
```

### Initialize Firebase in the Constructor

Set up the `FirebaseApp` instance using credentials from configuration:

```csharp
// Controllers/NotifyController.cs

namespace ApiJWT.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    [Authorize]
    public class NotifyController : ControllerBase
    {
        private readonly IConfiguration _configuration;
        private readonly FirebaseApp _firebaseApp;

        public NotifyController(IConfiguration configuration)
        {
            _configuration = configuration;

            if (FirebaseApp.GetInstance("MyApp") == null)
            {
                GoogleCredential credential = GoogleCredential.FromJson($@"
                    {{
                        ""type"": ""{_configuration["Firebase:Type"]}"",
                        ""project_id"": ""{_configuration["Firebase:ProjectId"]}"",
                        ""private_key_id"": ""{_configuration["Firebase:PrivateKeyId"]}"",
                        ""private_key"": ""{_configuration["Firebase:PrivateKey"]}"",
                        ""client_email"": ""{_configuration["Firebase:ClientEmail"]}"",
                        ""client_id"": ""{_configuration["Firebase:ClientId"]}"",
                        ""auth_uri"": ""{_configuration["Firebase:AuthUri"]}"",
                        ""token_uri"": ""{_configuration["Firebase:TokenUri"]}"",
                        ""auth_provider_x509_cert_url"": ""{_configuration["Firebase:AuthProviderCertUrl"]}"",
                        ""client_x509_cert_url"": ""{_configuration["Firebase:ClientCertUrl"]}""
                    }}
                ");

                FirebaseApp.Create(new AppOptions()
                {
                    Credential = credential
                }, "MyApp");
            }

            _firebaseApp = FirebaseApp.GetInstance("MyApp");
        }
    }
}
```

### Add the PostNotify Method

This endpoint receives a `Notify` object and sends the push notification:

```csharp
// Controllers/NotifyController.cs

using ApiJWT.Entities;
using FirebaseAdmin;
using FirebaseAdmin.Messaging;
using Google.Apis.Auth.OAuth2;
using Microsoft.AspNetCore.Mvc;

namespace ApiJWT.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    [Authorize]
    public class NotifyController : ControllerBase
    {
        private readonly IConfiguration _configuration;
        private readonly FirebaseApp _firebaseApp;

        public NotifyController(IConfiguration configuration)
        {
            _configuration = configuration;

            if (FirebaseApp.GetInstance("MyApp") == null)
            {
                GoogleCredential credential = GoogleCredential.FromJson($@"
                    {{
                        ""type"": ""{_configuration["Firebase:Type"]}"",
                        ""project_id"": ""{_configuration["Firebase:ProjectId"]}"",
                        ""private_key_id"": ""{_configuration["Firebase:PrivateKeyId"]}"",
                        ""private_key"": ""{_configuration["Firebase:PrivateKey"]}"",
                        ""client_email"": ""{_configuration["Firebase:ClientEmail"]}"",
                        ""client_id"": ""{_configuration["Firebase:ClientId"]}"",
                        ""auth_uri"": ""{_configuration["Firebase:AuthUri"]}"",
                        ""token_uri"": ""{_configuration["Firebase:TokenUri"]}"",
                        ""auth_provider_x509_cert_url"": ""{_configuration["Firebase:AuthProviderCertUrl"]}"",
                        ""client_x509_cert_url"": ""{_configuration["Firebase:ClientCertUrl"]}""
                    }}
                ");

                FirebaseApp.Create(new AppOptions()
                {
                    Credential = credential
                }, "MyApp");
            }

            _firebaseApp = FirebaseApp.GetInstance("MyApp");
        }

        [HttpPost]
        public async Task<ActionResult> PostNotify(Notify notify)
        {
            try
            {
                var tokens = new List<string>
                {
                    "token_xxx_xxx",
                    "token_xxx_xxx"
                };

                var messaging = FirebaseMessaging.GetMessaging(_firebaseApp);

                var message = new MulticastMessage()
                {
                    Notification = new Notification
                    {
                        Title = notify.Title,
                        Body = notify.Body
                    },
                    Tokens = tokens
                };

                BatchResponse response = await messaging.SendMulticastAsync(message);

                if (response.FailureCount > 0)
                {
                    for (int i = 0; i < tokens.Count; i++)
                    {
                        if (response.Responses[i].IsSuccess)
                        {
                            continue;
                        }

                        // Get the error
                        var error = response.Responses[i].Exception;

                        // Log the error
                        Console.WriteLine($"Error sending message to token {tokens[i]}: {error}");
                    }
                }

                return Ok(new
                {
                    message = $"Successfully sent {response.SuccessCount} messages. Failed to send {response.FailureCount} messages."
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new
                {
                    message = ex.Message,
                });
            }
        }
    }
}
```

## Conclusion

This article walked you step by step through implementing push notifications in an API using JWT and Firebase Cloud Messaging.
The provided code is a solid foundation for adding real-time notifications to your own applications. By integrating these features,
you’ll keep your users informed and engaged.

Feel free to leave questions or feedback in the comments below. If you found this guide helpful, share it with your colleagues!

Thank you for reading!
